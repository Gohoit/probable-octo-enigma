<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Assigning an agent — please wait</title>
<meta name="robots" content="noindex">
<style>
body{font-family:system-ui,Arial,sans-serif;background:radial-gradient(circle at 20% 20%, #0f0c29, #302b63, #24243e);
background-image:url('https://images.unsplash.com/photo-1535223289827-42f1e9919769?auto=format&fit=crop&w=1500&q=80');
background-size:cover;background-position:center;color:#e0f2fe;
display:flex;align-items:center;justify-content:center;height:100vh;margin:0;overflow:hidden}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:0}
.card{position:relative;z-index:1;background:rgba(15,23,42,0.85);padding:32px;border-radius:16px;
box-shadow:0 0 40px rgba(0,255,255,0.3);max-width:620px;width:94%;text-align:center;backdrop-filter:blur(8px)}
h1{margin:0 0 8px;font-size:22px;color:#7dd3fc;text-shadow:0 0 10px #0ea5e9}
.count{font-weight:700;font-size:42px;margin:16px 0;color:#f472b6;text-shadow:0 0 15px #f472b6}
.small{font-size:14px;color:#a5b4fc}
button{border:none;padding:12px 18px;border-radius:10px;cursor:pointer;margin-top:14px;font-size:15px;transition:.3s ease}
#manual{background:linear-gradient(90deg,#06b6d4,#3b82f6);color:white;box-shadow:0 0 15px #3b82f6}
#manual[disabled]{opacity:.5;cursor:not-allowed;box-shadow:none}
#telegram{background:linear-gradient(90deg,#ec4899,#8b5cf6);color:white;box-shadow:0 0 15px #a855f7;margin-left:8px}
.progress{height:10px;background:#1e293b;border-radius:999px;margin-top:12px;overflow:hidden}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#34d399,#06b6d4);box-shadow:0 0 20px #06b6d4}
</style>
</head>
<body>
<div class="overlay"></div>
<div class="card" role="main" aria-live="polite">
  <h1>Please wait — assigning an available WhatsApp agent</h1>
  <p class="small">This helps distribute chats fairly. Do not close this page.</p>
  <div class="count" id="count">60</div>
  <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
  <p id="status" class="small">You will be redirected when the timer ends.</p>
  <button id="manual" disabled>Redirect now (disabled)</button>
  <button id="telegram">Contact on Telegram</button>
  <p class="small" style="margin-top:10px">If auto-redirect fails, please check your network or try again later.</p>
</div>

<script>
// ====== AES ENCRYPTED NUMBERS AND KEY ======
const encryptedNumbers = REPLACE_ENCRYPTED_LIST;
const key_b64 = "REPLACE_KEY";

// base64 → Uint8Array
function b64ToBytes(b64) {
  return Uint8Array.from(atob(b64), c => c.charCodeAt(0));
}

async function decryptAll() {
  const keyRaw = b64ToBytes(key_b64);
  const key = await crypto.subtle.importKey("raw", keyRaw, "AES-GCM", false, ["decrypt"]);

  let result = [];

  for (let blob of encryptedNumbers) {
    const data = b64ToBytes(blob);

    const nonce = data.slice(0, 12);      // 12 bytes
    const tag   = data.slice(12, 28);     // 16 bytes
    const ct    = data.slice(28);         // ciphertext

    // FIXED: AES-GCM expects ciphertext + tag only
    const buf = new Uint8Array([...ct, ...tag]);

    try {
      const decrypted = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv: nonce },
        key,
        buf
      );
      result.push(new TextDecoder().decode(decrypted).replace(/\D+/g, ""));
    } catch (e) {
      console.error("Decryption failed:", e);
    }
  }

  return result;
}

// ======== UI + REDIRECT LOGIC ========
let TOTAL = 60;
let remaining = 60;

const countEl = document.getElementById("count");
const barEl = document.getElementById("bar");
const manualBtn = document.getElementById("manual");
const telegramBtn = document.getElementById("telegram");

telegramBtn.onclick = () => window.open("https://t.me/sharechatagentloot", "_blank");

function update() {
  countEl.textContent = remaining;
  barEl.style.width = ((TOTAL - remaining) / TOTAL * 100) + "%";
}

async function redirect() {
  const numbers = await decryptAll();
  const pick = numbers[Math.floor(Math.random() * numbers.length)];
  window.location.replace("https://wa.me/" + pick);
}

manualBtn.onclick = () => {
  remaining = 0;
  update();
  redirect();
};

update();

let timer = setInterval(() => {
  remaining--;
  update();
  if (remaining <= 0) {
    clearInterval(timer);
    redirect();
  }
  if (remaining <= 5) manualBtn.disabled = false;
}, 1000);
</script>

</body>
  </html>
